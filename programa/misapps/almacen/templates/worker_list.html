{% extends 'base.html' %}

{% block title %}Trabajadores{% endblock %}

{% block content %}
    <h2 class="titulo"> Trabajadores</h2>
    <table class="tablaEPP">
        <thead>
            <tr>
                <th>Código</th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Archivo</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for worker in item %}  
            <tr>
                <td>{{ worker.idWorker }}</td>  
                <td>{{ worker.name }}</td>
                <td>{{ worker.surname }}</td>
                <td>
                    {% if worker.archivo %}
                        <a href="{{ worker.archivo.url }}" target="_blank">Ver archivo</a>  
                    {% else %}
                        No archivo adjunto
                    {% endif %}
                </td>
                <!-- ..........................................  -->
                <td>
                    <button class="edit-button" data-id="{{ worker.idWorker }}" data-name="{{ worker.name }}" data-surname="{{ worker.surname }}">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <form method="post" action="{% url 'delete_worker' worker.idWorker %}" style="display:inline;" onsubmit="return confirmDelete();">
                        {% csrf_token %}
                        <button type="submit">
                            <i class="fas fa-trash-alt"></i> Eliminar
                        </button>
                    </form>
                </td>
                
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <nav class="agregar">
        <ul>
            <li><a href="{% url 'add_worker' %}"><i class="fas fa-plus"></i> Agregar Trabajador</a></li>
        </ul>
    </nav>
    <!-- ............................... -->
     <!-- Modal de Edición -->
     <div id="editModal" style="display:none;">
        <form method="post" enctype="multipart/form-data" id="editForm" onsubmit="return confirmEdit();">
            {% csrf_token %}
            <input type="hidden" name="idWorker" id="editId">
            <label for="editName">Nombre:</label>
            <input type="text" name="name" id="editName">
            <label for="editSurname">Apellido:</label>
            <input type="text" name="surname" id="editSurname">
            <label for="editArchivo">Archivo:</label>
            <input type="file" name="archivo" id="editArchivo">
            <button type="submit">Guardar Cambios</button>
        </form>
    </div>

    <script>
        document.querySelectorAll('.edit-button').forEach(button => {
            button.addEventListener('click', () => {
                document.getElementById('editId').value = button.dataset.id;
                document.getElementById('editName').value = button.dataset.name;
                document.getElementById('editSurname').value = button.dataset.surname;
                document.getElementById('editModal').style.display = 'block';
                document.getElementById('editForm').action = '/worker/edit/' + button.dataset.id + '/';
            });
        });

        function confirmDelete() {
            return confirm('¿Está seguro de que desea eliminar este trabajador?');
        }

        function confirmEdit() {
            return confirm('¿Está seguro de que desea guardar los cambios de este trabajador?');
        }
    </script>
{% endblock %}
