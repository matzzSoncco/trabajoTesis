{% extends 'base.html' %}

{% block title %}Lista de Materiales{% endblock %}

{% block content %}
    <h2 class="titulo">Materiales</h2>
    <table class="tablaEPP">
        <thead>
            <tr>
                <th>Código</th>
                <th>Nombre</th>
                <th>Cantidad</th>
                <th>Stock</th>
                <th>Archivo</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for material in materials %}
            <tr>
                <td>{{ material.idMaterial }}</td>
                <td>{{ material.name }}</td>
                <td>{{ material.quantity }}</td>
                <td>{{ material.stock }}</td>
                <td>
                    {% if material.archivo %}
                        <a href="{{ material.archivo.url }}" target="_blank">Ver archivo</a>
                    {% else %}
                        No archivo adjunto
                    {% endif %}
                </td>
                <!-- Se agrego el CRUD ..........-->
                <td>
                    <button class="edit-button" data-id="{{ material.idEquipment }}" data-name="{{ material.name }}" data-quantity="{{ material.quantity }}" data-stock="{{ material.stock }}">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <form method="post" action="{% url 'delete_material' material.idEquipment %}" style="display:inline;" onsubmit="return confirmDelete();">
                        {% csrf_token %}
                        <button type="submit">
                            <i class="fas fa-trash-alt"></i> Eliminar
                        </button>
                    </form>
                </td>
                
                <!-- ......................................  -->
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <nav class="agregar">
        <ul>
            <li><a href="{% url 'add_material' %}"><i class="fas fa-plus"></i> Agregar Material</a></li>
        </ul>
    </nav>
    <!-- ..................... -->
    <!-- Modal de Edición -->
    <div id="editModal" style="display:none;">
        <form method="post" enctype="multipart/form-data" id="editForm" onsubmit="return confirmEdit();">
            {% csrf_token %}
            <input type="hidden" name="idEquipment" id="editId">
            <label for="editName">Nombre:</label>
            <input type="text" name="name" id="editName">
            <label for="editQuantity">Cantidad:</label>
            <input type="number" name="quantity" id="editQuantity">
            <label for="editStock">Stock:</label>
            <input type="number" name="stock" id="editStock">
            <label for="editArchivo">Archivo:</label>
            <input type="file" name="archivo" id="editArchivo">
            <button type="submit">Guardar Cambios</button>
        </form>
    </div>

    <script>
        document.querySelectorAll('.edit-button').forEach(button => {
            button.addEventListener('click', () => {
                document.getElementById('editId').value = button.dataset.id;
                document.getElementById('editName').value = button.dataset.name;
                document.getElementById('editQuantity').value = button.dataset.quantity;
                document.getElementById('editStock').value = button.dataset.stock;
                document.getElementById('editModal').style.display = 'block';
                document.getElementById('editForm').action = '/material/edit/' + button.dataset.id + '/';
            });
        });

        function confirmDelete() {
            return confirm('¿Está seguro de que desea eliminar este material?');
        }

        function confirmEdit() {
            return confirm('¿Está seguro de que desea guardar los cambios de este material?');
        }
    </script>
{% endblock %}

